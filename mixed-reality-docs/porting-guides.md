---
title: 移植指南
description: 介绍如何将现有沉浸式应用程序移植到 Windows Mixed Reality 的分步演练。
author: JBrentJ
ms.author: alexturn
ms.date: 07/07/2020
ms.topic: article
keywords: 端口，移植，unity，中间件，引擎，UWP，Win32
ms.openlocfilehash: a1e3cd47096d728091d62d6c038bf6b2eb6bab16
ms.sourcegitcommit: 0eb99fae933d4374af2c032af4e9ceda1807e532
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 07/09/2020
ms.locfileid: "86156768"
---
# <a name="porting-guides"></a><span data-ttu-id="b7d9a-104">移植指南</span><span class="sxs-lookup"><span data-stu-id="b7d9a-104">Porting guides</span></span>

## <a name="overview"></a><span data-ttu-id="b7d9a-105">概述</span><span class="sxs-lookup"><span data-stu-id="b7d9a-105">Overview</span></span>

<span data-ttu-id="b7d9a-106">Windows 10 包括对沉浸式和全息耳机的直接支持。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-106">Windows 10 includes direct support for immersive and holographic headsets.</span></span> <span data-ttu-id="b7d9a-107">如果已为其他设备（如 Oculus Rift 或 HTC Naopak）生成内容，这些内容将依赖于操作系统的平台 API 之上的库。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-107">If you've built content for other devices, such as the Oculus Rift or HTC Vive, these have dependencies on libraries that exist above the operating system's platform API.</span></span> <span data-ttu-id="b7d9a-108">将现有内容引入 Windows Mixed Reality 涉及到重定目标将这些其他 Sdk 用于 Windows Api。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-108">Bringing existing content over to Windows Mixed Reality involves retargeting usage of these other SDKs to the Windows APIs.</span></span> <span data-ttu-id="b7d9a-109">[用于混合现实的 Windows 平台 api](https://docs.microsoft.com/uwp/api/Windows.Perception)适用于 Win32 和通用 WINDOWS 平台（UWP）应用模型。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-109">The [Windows platform APIs for mixed reality](https://docs.microsoft.com/uwp/api/Windows.Perception) work with both the Win32 and the Universal Windows Platform (UWP) app model.</span></span> <span data-ttu-id="b7d9a-110">如果你的应用尚未构建给 UWP，则将其更改为 UWP 会成为移植体验的一部分。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-110">If your app isn't already built for UWP, changing over to UWP will be part of the porting experience.</span></span>

## <a name="porting-overview"></a><span data-ttu-id="b7d9a-111">移植概述</span><span class="sxs-lookup"><span data-stu-id="b7d9a-111">Porting overview</span></span>

<span data-ttu-id="b7d9a-112">在高级别上，迁移现有内容涉及以下步骤：</span><span class="sxs-lookup"><span data-stu-id="b7d9a-112">At a high level, the following steps are involved in porting existing content:</span></span>
1. <span data-ttu-id="b7d9a-113">**请确保您的 PC 正在运行 Windows 10 秋季创意者更新（16299）。**</span><span class="sxs-lookup"><span data-stu-id="b7d9a-113">**Make sure your PC is running the Windows 10 Fall Creators Update (16299).**</span></span> <span data-ttu-id="b7d9a-114">我们不再建议从有问必答向后跳环接收预览版，因为这些版本对于混合现实开发不是最稳定的。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-114">We no longer recommend receiving preview builds from the Insider Skip Ahead ring, as those builds won't be the most stable for mixed reality development.</span></span>
2. <span data-ttu-id="b7d9a-115">**升级到最新版本的图形或游戏引擎。**</span><span class="sxs-lookup"><span data-stu-id="b7d9a-115">**Upgrade to the latest version of your graphics or game engine.**</span></span> <span data-ttu-id="b7d9a-116">游戏引擎需要支持 Windows 10 SDK 版本10.0.15063.0 （发布于2017年4月）或更高版本。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-116">Game engines will need to support the Windows 10 SDK version 10.0.15063.0 (released in April 2017) or higher.</span></span>
3. <span data-ttu-id="b7d9a-117">**升级任何中间件、插件或组件。**</span><span class="sxs-lookup"><span data-stu-id="b7d9a-117">**Upgrade any middleware, plug-ins, or components.**</span></span> <span data-ttu-id="b7d9a-118">如果你的应用程序包含任何组件，则最好升级到最新版本。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-118">If your app contains any components, it's a good idea to upgrade to the latest version.</span></span> <span data-ttu-id="b7d9a-119">最常见的插件的较新版本支持 UWP。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-119">Newer versions of most common plug-ins have support for UWP.</span></span>
4. <span data-ttu-id="b7d9a-120">**删除重复的 sdk 依赖项**。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-120">**Remove dependencies on duplicate SDKs**.</span></span> <span data-ttu-id="b7d9a-121">根据你的内容面向哪个设备，你将需要删除或有条件地编译该 SDK （例如，SteamVR），以便可以改为面向 Windows Api。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-121">Depending on which device your content was targeting, you'll need to remove or conditionally compile out that SDK (for example, SteamVR) so you can target the Windows APIs instead.</span></span>
5. <span data-ttu-id="b7d9a-122">**处理生成问题。**</span><span class="sxs-lookup"><span data-stu-id="b7d9a-122">**Work through build issues.**</span></span> <span data-ttu-id="b7d9a-123">此时，迁移练习特定于您的应用程序、您的引擎和您拥有的组件依赖项。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-123">At this point, the porting exercise is specific to your app, your engine, and the component dependencies you have.</span></span>

## <a name="common-porting-steps"></a><span data-ttu-id="b7d9a-124">常见的移植步骤</span><span class="sxs-lookup"><span data-stu-id="b7d9a-124">Common porting steps</span></span>

### <a name="common-step-1-make-sure-you-have-the-right-development-hardware"></a><span data-ttu-id="b7d9a-125">常见步骤1：确保拥有正确的开发硬件</span><span class="sxs-lookup"><span data-stu-id="b7d9a-125">Common step 1: Make sure you have the right development hardware</span></span>

<span data-ttu-id="b7d9a-126">"[安装工具](install-the-tools.md#for-immersive-vr-headset-development)" 页将列出推荐的开发硬件。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-126">The [install the tools](install-the-tools.md#for-immersive-vr-headset-development) page lists the recommended development hardware.</span></span>

### <a name="common-step-2-upgrade-to-the-latest-flight-of-windows-10"></a><span data-ttu-id="b7d9a-127">常见步骤2：升级到 Windows 10 的最新航班</span><span class="sxs-lookup"><span data-stu-id="b7d9a-127">Common step 2: Upgrade to the latest flight of Windows 10</span></span>

<span data-ttu-id="b7d9a-128">Windows Mixed Reality 平台仍处于积极开发阶段。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-128">The Windows Mixed Reality platform is still under active development.</span></span> <span data-ttu-id="b7d9a-129">建议[加入 Windows 预览体验计划](https://insider.windows.com/)，以访问 "Windows 有问必答 Fast" 航班。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-129">We recommend [joining the Windows Insider Program](https://insider.windows.com/) to access the "Windows Insider Fast" flight.</span></span>
1. <span data-ttu-id="b7d9a-130">安装[Windows 10 创意者更新](https://www.microsoft.com/software-download/windows10)</span><span class="sxs-lookup"><span data-stu-id="b7d9a-130">Install the [Windows 10 Creators Update](https://www.microsoft.com/software-download/windows10)</span></span>
2. <span data-ttu-id="b7d9a-131">[加入](https://insider.windows.com/)Windows 预览体验计划。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-131">[Join](https://insider.windows.com/) the Windows Insider Program.</span></span>
3. <span data-ttu-id="b7d9a-132">启用[开发人员模式](https://docs.microsoft.com/windows/uwp/get-started/enable-your-device-for-development)</span><span class="sxs-lookup"><span data-stu-id="b7d9a-132">Enable [Developer Mode](https://docs.microsoft.com/windows/uwp/get-started/enable-your-device-for-development)</span></span>
4. <span data-ttu-id="b7d9a-133">通过 "**设置" > 更新 & 安全 "部分**，切换到[Windows 预览体验快速航班](https://blogs.technet.microsoft.com/uktechnet/2016/07/01/joining-insider-preview)</span><span class="sxs-lookup"><span data-stu-id="b7d9a-133">Switch to the [Windows Insider Fast flights](https://blogs.technet.microsoft.com/uktechnet/2016/07/01/joining-insider-preview) through **Settings > Update & Security Section**</span></span>

### <a name="common-step-3-upgrade-to-the-most-recent-build-of-visual-studio-uwp-only"></a><span data-ttu-id="b7d9a-134">常见步骤3：升级到最新版本的 Visual Studio （仅 UWP）</span><span class="sxs-lookup"><span data-stu-id="b7d9a-134">Common step 3: Upgrade to the most recent build of Visual Studio (UWP only)</span></span>
* <span data-ttu-id="b7d9a-135">请参阅 Visual Studio 2019 下[的安装工具](install-the-tools.md#installation-checklist)页面</span><span class="sxs-lookup"><span data-stu-id="b7d9a-135">See [Install the tools](install-the-tools.md#installation-checklist) page under Visual Studio 2019</span></span>

### <a name="common-step-4-be-ready-for-the-store-uwp-only"></a><span data-ttu-id="b7d9a-136">常见步骤4：准备好存储（仅 UWP）</span><span class="sxs-lookup"><span data-stu-id="b7d9a-136">Common step 4: Be Ready for The Store (UWP only)</span></span>
* <span data-ttu-id="b7d9a-137">尽早并经常使用[Windows 应用程序认证工具包](https://developer.microsoft.com/windows/develop/app-certification-kit)（也称为 WACK）！</span><span class="sxs-lookup"><span data-stu-id="b7d9a-137">Use [Windows App Certification Kit](https://developer.microsoft.com/windows/develop/app-certification-kit) (also known as WACK) early and often!</span></span>
* <span data-ttu-id="b7d9a-138">使用可[移植性分析器](https://docs.microsoft.com/dotnet/standard/portability-analyzer)（[下载](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer)）</span><span class="sxs-lookup"><span data-stu-id="b7d9a-138">Use [Portability Analyzer](https://docs.microsoft.com/dotnet/standard/portability-analyzer) ([Download](https://marketplace.visualstudio.com/items?itemName=ConnieYau.NETPortabilityAnalyzer))</span></span>

### <a name="common-step-5-choose-the-correct-adapter"></a><span data-ttu-id="b7d9a-139">常见步骤5：选择正确的适配器</span><span class="sxs-lookup"><span data-stu-id="b7d9a-139">Common step 5: Choose the correct Adapter</span></span>
* <span data-ttu-id="b7d9a-140">在包含两个 Gpu 的笔记本系统中，[针对正确的适配器](rendering-in-directx.md#hybrid-graphics-pcs-and-mixed-reality-applications)。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-140">In systems like notebooks with two GPUs, [target the correct adapter](rendering-in-directx.md#hybrid-graphics-pcs-and-mixed-reality-applications).</span></span> <span data-ttu-id="b7d9a-141">这适用于 Unity 和本机 DirectX 应用，其中 ID3D11Device 是为其功能显式或隐式（媒体基础）创建的。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-141">This applies to Unity and native DirectX apps where a ID3D11Device is created, either explicitly or implicitly (Media Foundation), for its functionality.</span></span>

## <a name="unity-porting-guidance"></a><span data-ttu-id="b7d9a-142">Unity 移植指南</span><span class="sxs-lookup"><span data-stu-id="b7d9a-142">Unity porting guidance</span></span>

### <a name="unity-step-1-follow-the-common-porting-steps"></a><span data-ttu-id="b7d9a-143">Unity 步骤1：遵循常见的移植步骤</span><span class="sxs-lookup"><span data-stu-id="b7d9a-143">Unity step 1: Follow the common porting steps</span></span>

<span data-ttu-id="b7d9a-144">执行所有常见步骤。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-144">Follow all of the common steps.</span></span> <span data-ttu-id="b7d9a-145">在步骤 #3 中，选择 "**包含 Unity 的游戏开发**" 工作负荷。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-145">When in step #3, select the **Game Development with Unity** workload.</span></span> <span data-ttu-id="b7d9a-146">您可以取消选择 Unity 编辑器可选组件，因为您将从下面的说明中安装新版本的 Unity。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-146">You may deselect the Unity Editor optional component since you'll be installing a newer version of Unity from the instructions below.</span></span>

### <a name="unity-step-2-upgrade-to-the-latest-public-build-of-unity-with-windows-mr-support"></a><span data-ttu-id="b7d9a-147">Unity 步骤2：通过 Windows MR 支持升级到 Unity 的最新公共版本</span><span class="sxs-lookup"><span data-stu-id="b7d9a-147">Unity step 2: Upgrade to the latest public build of Unity with Windows MR Support</span></span>
1. <span data-ttu-id="b7d9a-148">下载最新建议的具有混合现实支持[的 Unity 公共内部版本](install-the-tools.md)。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-148">Download the latest [recommended public build of Unity](install-the-tools.md) with mixed reality support.</span></span>
2. <span data-ttu-id="b7d9a-149">在开始之前保存项目的副本</span><span class="sxs-lookup"><span data-stu-id="b7d9a-149">Save a copy of your project before you get started</span></span>
3. <span data-ttu-id="b7d9a-150">查看在迁移时可从 Unity 获得的[文档](https://docs.unity3d.com/Manual/UpgradeGuides.html)。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-150">Review the [documentation](https://docs.unity3d.com/Manual/UpgradeGuides.html) available from Unity on porting.</span></span>
4. <span data-ttu-id="b7d9a-151">按照 Unity 站点上的[说明](https://docs.unity3d.com/Manual/APIUpdater.html)使用其自动 API 更新程序</span><span class="sxs-lookup"><span data-stu-id="b7d9a-151">Follow the [instructions](https://docs.unity3d.com/Manual/APIUpdater.html) on Unity's site for using their automatic API updater</span></span>
5. <span data-ttu-id="b7d9a-152">检查并查看你是否需要进行其他更改以使你的项目运行，并处理剩余的错误和警告。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-152">Check and see if there are additional changes that you need to make to get your project running, and work through any remaining errors and warnings.</span></span> 

> [!Note] 
> <span data-ttu-id="b7d9a-153">如果有依赖的中间件，请检查使用的是最新版本（下面的步骤3中的详细信息）。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-153">If you have middleware that you depend on, check that you're using the latest release (more details in step 3 below).</span></span>

### <a name="unity-step-3-upgrade-your-middleware-to-the-latest-versions"></a><span data-ttu-id="b7d9a-154">Unity 步骤3：将中间件升级到最新版本</span><span class="sxs-lookup"><span data-stu-id="b7d9a-154">Unity step 3: Upgrade your middleware to the latest versions</span></span>

<span data-ttu-id="b7d9a-155">对于任何 Unity 更新，都有可能需要更新游戏或应用程序所依赖的一个或多个中间件包。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-155">With any Unity update, there's a good chance that you'll need to update one or more middleware packages that your game or application depends on.</span></span> <span data-ttu-id="b7d9a-156">此外，最新的中间件是最新的，最新的中间件会在整个移植过程中增加成功的可能性。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-156">Additionally, being up to date with the latest middleware increases the likelihood of success throughout the rest of the porting process.</span></span> <span data-ttu-id="b7d9a-157">许多中间件包都最近添加了对通用 Windows 平台（UWP）的支持，升级到最新版本后，便可以利用这一工作。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-157">Many middleware packages have recently added support for Universal Windows Platform (UWP), and upgrading to the most recent versions will let you leverage that work.</span></span>

### <a name="unity-step-4-target-your-application-to-run-on-universal-windows-platform-uwp"></a><span data-ttu-id="b7d9a-158">Unity 步骤4：将应用程序设定为在通用 Windows 平台（UWP）上运行</span><span class="sxs-lookup"><span data-stu-id="b7d9a-158">Unity step 4: Target your application to run on Universal Windows Platform (UWP)</span></span>

<span data-ttu-id="b7d9a-159">如果要以 Win32 为目标，则可以跳过此步骤，并继续执行步骤5。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-159">If you're targeting Win32, you can skip this step and continue to step 5.</span></span>

<span data-ttu-id="b7d9a-160">安装这些工具后，需要将应用作为通用 Windows 应用运行。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-160">After installing the tools, you need to get your app running as a Universal Windows app.</span></span>

* <span data-ttu-id="b7d9a-161">按照 Unity 提供的[详细分步指导](https://unity3d.com/partners/microsoft/porting-guides)进行操作。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-161">Follow the [detailed step by step walk through](https://unity3d.com/partners/microsoft/porting-guides) provided by Unity.</span></span> <span data-ttu-id="b7d9a-162">对于 Windows MR，你应该停留在最新的 LTS 版本（任何20xx 版本）上。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-162">You should stay on the latest LTS release (any 20xx.4 release) for Windows MR.</span></span>
* <span data-ttu-id="b7d9a-163">有关 UWP 开发资源的详细信息，请参阅[Windows 10 游戏开发指南](https://docs.microsoft.com/windows/uwp/gaming/e2e)。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-163">For more UWP development resources, take a look at the [Windows 10 game development guide](https://docs.microsoft.com/windows/uwp/gaming/e2e).</span></span>

> [!NOTE]
> <span data-ttu-id="b7d9a-164">Unity 继续改进 IL2CPP 支持;IL2CPP 使某些 UWP 端口变得更简单。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-164">Unity continues to improve IL2CPP support; IL2CPP makes some UWP ports easier.</span></span> <span data-ttu-id="b7d9a-165">如果你当前面向的是 .NET 脚本编写后端，则应考虑将转换为使用 IL2CPP 后端。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-165">If you are currently targeting the .NET scripting backend, you should consider converting to leverage the IL2CPP backend instead.</span></span>

* <span data-ttu-id="b7d9a-166">可以跳过 "Unity 步骤 5"，因为目标是 UWP 而不是 Win32。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-166">You can skip "Unity step 5" since you're targeting UWP instead of Win32.</span></span>

> [!NOTE] 
> <span data-ttu-id="b7d9a-167">如果你的应用程序在特定于设备的服务上有任何依赖关系，例如，从流中进行匹配，则需要在此步骤中禁用它们。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-167">If your application has any dependencies on device-specific services, such as match making from Steam, you'll need to disable them at this step.</span></span> <span data-ttu-id="b7d9a-168">你可以挂钩到 Windows 稍后提供的等效服务。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-168">You can hook up to the equivalent services that Windows provides later on.</span></span>

### <a name="unity-step-5-target-your-application-to-run-on-win32"></a><span data-ttu-id="b7d9a-169">Unity 步骤5：将应用程序定位到在 Win32 上运行</span><span class="sxs-lookup"><span data-stu-id="b7d9a-169">Unity step 5: Target your application to run on Win32</span></span>

<span data-ttu-id="b7d9a-170">从 Unity 应用程序内部：</span><span class="sxs-lookup"><span data-stu-id="b7d9a-170">From inside your Unity application:</span></span>

* <span data-ttu-id="b7d9a-171">导航到 "文件-> 生成设置"</span><span class="sxs-lookup"><span data-stu-id="b7d9a-171">Navigate to File -> Build Settings</span></span>
* <span data-ttu-id="b7d9a-172">选择 "PC、Mac、Linux 独立版"</span><span class="sxs-lookup"><span data-stu-id="b7d9a-172">Select "PC, Mac, Linux Standalone"</span></span>
* <span data-ttu-id="b7d9a-173">将目标平台设置为 "Windows"</span><span class="sxs-lookup"><span data-stu-id="b7d9a-173">Set target platform to "Windows"</span></span>
* <span data-ttu-id="b7d9a-174">将体系结构设置为 "x86" 选择 "切换平台"</span><span class="sxs-lookup"><span data-stu-id="b7d9a-174">Set architecture to "x86" Select "Switch Platform"</span></span>


### <a name="unity-step-6-setup-your-windows-mixed-reality-hardware"></a><span data-ttu-id="b7d9a-175">Unity 步骤6：设置 Windows Mixed Reality 硬件</span><span class="sxs-lookup"><span data-stu-id="b7d9a-175">Unity step 6: Setup your Windows Mixed Reality hardware</span></span>
1. <span data-ttu-id="b7d9a-176">查看[沉浸式耳机安装程序](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/before-you-start
)中的步骤</span><span class="sxs-lookup"><span data-stu-id="b7d9a-176">Review steps in [Immersive headset setup](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/before-you-start
)</span></span>
2. <span data-ttu-id="b7d9a-177">了解如何[使用 Windows Mixed reality 模拟器](using-the-windows-mixed-reality-simulator.md)并[导航 windows mixed reality 主页](navigating-the-windows-mixed-reality-home.md)</span><span class="sxs-lookup"><span data-stu-id="b7d9a-177">Learn about [Using the Windows Mixed Reality simulator](using-the-windows-mixed-reality-simulator.md) and [Navigating the Windows Mixed Reality home](navigating-the-windows-mixed-reality-home.md)</span></span>

### <a name="unity-step-7-target-your-application-to-run-on-windows-mixed-reality"></a><span data-ttu-id="b7d9a-178">Unity 步骤7：使应用程序面向在 Windows Mixed Reality 上运行</span><span class="sxs-lookup"><span data-stu-id="b7d9a-178">Unity step 7: Target your application to run on Windows Mixed Reality</span></span>
1. <span data-ttu-id="b7d9a-179">首先，必须将特定于特定的 VR SDK 的任何其他库支持删除或有条件地编译掉。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-179">First, you must remove or conditionally compile out any other library support specific to a particular VR SDK.</span></span> <span data-ttu-id="b7d9a-180">这些资产经常以与其他 VR Sdk （如 Windows Mixed Reality）不兼容的方式更改项目的设置和属性。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-180">Those assets frequently change settings and properties on your project in ways that are incompatible with other VR SDKs, such as Windows Mixed Reality.</span></span>
    * <span data-ttu-id="b7d9a-181">例如，如果你的项目引用 SteamVR SDK，则需要更新你的项目，以在导出 Windows 应用商店生成目标时排除这些 prototyping 和脚本 API 调用。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-181">For example, if your project references the SteamVR SDK, you'll need to update your project to exclude those prefabs and script API calls when exporting for the Windows Store build target.</span></span>
    * <span data-ttu-id="b7d9a-182">即将推出其他用于有条件地排除其他 VR Sdk 的特定步骤。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-182">Specific steps for conditionally excluding other VR SDKs are coming soon.</span></span>
2. <span data-ttu-id="b7d9a-183">在 Unity 项目中，[面向 Windows 10 SDK](holograms-100.md#target-windows-10-sdk)</span><span class="sxs-lookup"><span data-stu-id="b7d9a-183">In your Unity project, [target the Windows 10 SDK](holograms-100.md#target-windows-10-sdk)</span></span>
3. <span data-ttu-id="b7d9a-184">对于每个场景，[设置照相机](holograms-100.md#chapter-2---setup-the-camera)</span><span class="sxs-lookup"><span data-stu-id="b7d9a-184">For each scene, [setup the camera](holograms-100.md#chapter-2---setup-the-camera)</span></span>

### <a name="unity-step-8-use-the-stage-to-place-content-on-the-floor"></a><span data-ttu-id="b7d9a-185">Unity 步骤8：使用舞台将内容放到地面上</span><span class="sxs-lookup"><span data-stu-id="b7d9a-185">Unity step 8: Use the stage to place content on the floor</span></span>

<span data-ttu-id="b7d9a-186">您可以在各种[经验](coordinate-systems.md)范围内构建混合现实体验。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-186">You can build Mixed Reality experiences across a wide range of [experience scales](coordinate-systems.md).</span></span>

<span data-ttu-id="b7d9a-187">如果要移植**固定规模的体验**，必须确保将 Unity 设置为**静止**跟踪空间类型：</span><span class="sxs-lookup"><span data-stu-id="b7d9a-187">If you're porting a **seated-scale experience**, you must ensure Unity is set to the **Stationary** tracking space type:</span></span>

```cs
XRDevice.SetTrackingSpaceType(TrackingSpaceType.Stationary);
```

<span data-ttu-id="b7d9a-188">上述代码将设置 Unity 的世界坐标系统，以跟踪[固定的引用框架](coordinate-systems.md#spatial-coordinate-systems)。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-188">This above code sets Unity's world coordinate system to track the [stationary frame of reference](coordinate-systems.md#spatial-coordinate-systems).</span></span> <span data-ttu-id="b7d9a-189">在静止跟踪模式下，在打开应用程序时，位于面板默认位置（正向-Z）前面的编辑器中的内容将显示在用户的前方。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-189">In the Stationary tracking mode, content placed in the editor just in front of the camera's default location (forward is -Z) appears in front of the user when the app launches.</span></span> <span data-ttu-id="b7d9a-190">若要 recenter 用户的固定来源，可以调用 Unity 的[XR。InputTracking. Recenter](https://docs.unity3d.com/ScriptReference/XR.InputTracking.Recenter.html)方法。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-190">To recenter the user's seated origin, you can call Unity's [XR.InputTracking.Recenter](https://docs.unity3d.com/ScriptReference/XR.InputTracking.Recenter.html) method.</span></span>

<span data-ttu-id="b7d9a-191">如果迁移的是**大规模体验**或**房间规模体验**，将会相对于地面放置内容。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-191">If you're porting a **standing-scale experience** or **room-scale experience**, you'll be placing content relative to the floor.</span></span> <span data-ttu-id="b7d9a-192">使用**[空间阶段](coordinate-systems.md#spatial-coordinate-systems)**（表示用户在首次运行期间设置的已定义的层级来源和可选房间边界）的原因。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-192">You reason about the user's floor using the **[spatial stage](coordinate-systems.md#spatial-coordinate-systems)**, which represents the user's defined floor-level origin and optional room boundary, set up during first run.</span></span> <span data-ttu-id="b7d9a-193">对于这些体验，必须确保将 Unity 设置为**RoomScale**跟踪空间类型。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-193">For these experiences, you must ensure Unity is set to the **RoomScale** tracking space type.</span></span> <span data-ttu-id="b7d9a-194">尽管 RoomScale 是默认值，但你需要对其进行显式设置，并确保返回 true，以便捕获用户将其计算机从其校准的房间离开的情况：</span><span class="sxs-lookup"><span data-stu-id="b7d9a-194">While RoomScale is the default, you'll want to set it explicitly and ensure you get back true, to catch situations where the user has moved their computer away from the room they calibrated:</span></span>

```cs
if (XRDevice.SetTrackingSpaceType(TrackingSpaceType.RoomScale))
{
    // RoomScale mode was set successfully.  App can now assume that y=0 in Unity world coordinate represents the floor.
}
else
{
    // RoomScale mode was not set successfully.  App cannot make assumptions about where the floor plane is.
}
```

<span data-ttu-id="b7d9a-195">应用成功设置 RoomScale 跟踪空间类型后，放置在 y = 0 平面上的内容将显示在地面上。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-195">Once your app successfully sets the RoomScale tracking space type, content placed on the y=0 plane will appear on the floor.</span></span> <span data-ttu-id="b7d9a-196">位于（0，0，0）的原点将是用户在房间安装期间考验的特定位置，并以-Z 表示在安装过程中所面临的正向方向。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-196">The origin at (0, 0, 0) will be the specific place on the floor where the user stood during room setup, with -Z representing the forward direction they were facing during setup.</span></span>

<span data-ttu-id="b7d9a-197">在脚本代码中，您可以对 UnityEngine 调用 TryGetGeometry 方法来获取边界多边形，并指定 "TrackedArea" 的边界类型。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-197">In script code, you can then call the TryGetGeometry method on you're the UnityEngine.Experimental.XR.Boundary type to get a boundary polygon, specifying a boundary type of TrackedArea.</span></span> <span data-ttu-id="b7d9a-198">如果用户定义了边界（返回顶点的列表），则可安全地向用户提供**房间规模的体验**，用户可在其中浏览你创建的场景。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-198">If the user defined a boundary (you get back a list of vertices), it's safe to deliver a **room-scale experience** to the user, where they can walk around the scene you create.</span></span>

<span data-ttu-id="b7d9a-199">当用户接近边界时，系统将自动渲染边界。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-199">The system will automatically render the boundary when the user approaches it.</span></span> <span data-ttu-id="b7d9a-200">您的应用程序不需要使用此多边形来呈现边界本身。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-200">Your app does not need to use this polygon to render the boundary itself.</span></span>

<span data-ttu-id="b7d9a-201">有关详细信息，请参阅[Unity 页中的坐标系统](coordinate-systems-in-unity.md)。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-201">For more information, see the [Coordinate systems in Unity](coordinate-systems-in-unity.md) page.</span></span>

<span data-ttu-id="b7d9a-202">某些应用程序使用矩形来约束其交互。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-202">Some applications use a rectangle to constrain their interaction.</span></span> <span data-ttu-id="b7d9a-203">UWP API 或 Unity 中不直接支持检索最大的内接矩形。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-203">Retrieving the largest inscribed rectangle is not directly supported in the UWP API or Unity.</span></span> <span data-ttu-id="b7d9a-204">链接到下面的示例代码演示了如何在跟踪边界内查找矩形。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-204">The example code linked to below shows how to find a rectangle within the traced bounds.</span></span> <span data-ttu-id="b7d9a-205">它基于试探法，因此可能找不到最佳解决方案，但结果与预期一致。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-205">It's heuristic-based so may not find the optimal solution, however, results are consistent with expectations.</span></span> <span data-ttu-id="b7d9a-206">可以优化算法中的参数，以在处理时间成本中查找更精确的结果。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-206">Parameters in the algorithm can be tuned to find more precise results at the cost of processing time.</span></span> <span data-ttu-id="b7d9a-207">该算法位于混合现实工具包的分叉中，该工具包使用 5.6 preview MRTP 版本的 Unity。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-207">The algorithm is in a fork of the Mixed Reality Toolkit that uses the 5.6 preview MRTP version of Unity.</span></span> <span data-ttu-id="b7d9a-208">这不是公开提供的。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-208">This isn't publicly available.</span></span> <span data-ttu-id="b7d9a-209">代码应可直接在2017.2 和更高版本的 Unity 中使用。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-209">The code should be directly usable in 2017.2 and higher versions of Unity.</span></span> <span data-ttu-id="b7d9a-210">在不久的将来，会将代码移植到当前 MRTK。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-210">The code will be ported to the current MRTK in the near future.</span></span>

<span data-ttu-id="b7d9a-211">[GitHub 上的代码的 zip 文件](https://github.com/KevinKennedy/MixedRealityToolkit-Unity/releases/tag/5.6.MRTP20)重要文件：</span><span class="sxs-lookup"><span data-stu-id="b7d9a-211">[zip file of code on GitHub](https://github.com/KevinKennedy/MixedRealityToolkit-Unity/releases/tag/5.6.MRTP20) Important files:</span></span>
* <span data-ttu-id="b7d9a-212">资产/HoloToolkit/阶段/脚本/StageManager-用法示例</span><span class="sxs-lookup"><span data-stu-id="b7d9a-212">Assets/HoloToolkit/Stage/Scripts/StageManager.cs - example of usage</span></span>
* <span data-ttu-id="b7d9a-213">资产/HoloToolkit/阶段/脚本/LargestRectangle-算法的实现</span><span class="sxs-lookup"><span data-stu-id="b7d9a-213">Assets/HoloToolkit/Stage/Scripts/LargestRectangle.cs - implementation of the algorithm</span></span>
* <span data-ttu-id="b7d9a-214">资产/HoloToolkit-Run-unittests/Editor/Stage/LargestRectangleTest-算法的普通测试</span><span class="sxs-lookup"><span data-stu-id="b7d9a-214">Assets/HoloToolkit-UnitTests/Editor/Stage/LargestRectangleTest.cs - trivial test of the algorithm</span></span>

<span data-ttu-id="b7d9a-215">结果示例：</span><span class="sxs-lookup"><span data-stu-id="b7d9a-215">Example of results:</span></span>

![结果示例](images/largestrectangle-400px.jpg)

<span data-ttu-id="b7d9a-217">算法基于 Daniel Smilkov：[多边形中的最大矩形](https://d3plus.org/blog/behind-the-scenes/2014/07/08/largest-rect/)的博客</span><span class="sxs-lookup"><span data-stu-id="b7d9a-217">Algorithm is based on a blog by Daniel Smilkov: [Largest rectangle in a polygon](https://d3plus.org/blog/behind-the-scenes/2014/07/08/largest-rect/)</span></span>

### <a name="unity-step-9-work-through-your-input-model"></a><span data-ttu-id="b7d9a-218">Unity 步骤9：处理输入模型</span><span class="sxs-lookup"><span data-stu-id="b7d9a-218">Unity step 9: Work through your input model</span></span>

<span data-ttu-id="b7d9a-219">每个面向现有 HMD 的游戏或应用程序都将具有一组可处理的输入，其所需的输入类型和体验所需的特定 Api 以及用于获取这些输入的特定 Api。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-219">Each game or application targeting an existing HMD will have a set of inputs that it handles, types of inputs that it needs for the experience, and specific APIs that it calls to get those inputs.</span></span> <span data-ttu-id="b7d9a-220">我们已经投入了大量努力，尽可能简单直接地利用 Windows Mixed Reality 中提供的输入。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-220">We've invested in trying to make it as simple and straightforward as possible to take advantage of the inputs available in Windows Mixed Reality.</span></span>
1. <span data-ttu-id="b7d9a-221">通读有关 Windows Mixed Reality 如何公开输入的详细信息，以及如何映射到你的应用程序可以执行的**[操作的详细](input-porting-guide-for-unity.md)** 信息。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-221">Read through the **[Input porting guide for Unity](input-porting-guide-for-unity.md)** for details of how Windows Mixed Reality exposes input, and how that maps to what your application may do today.</span></span>
2. <span data-ttu-id="b7d9a-222">选择是要使用 Unity 的跨 VR-SDK 输入 API 还是 MR 专用输入 API。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-222">Choose whether you're going to leverage Unity's cross-VR-SDK input API, or the MR-specific input API.</span></span> <span data-ttu-id="b7d9a-223">当前，Unity VR 应用使用一般输入. GetButton/GetAxis Api 进行[Oculus 输入](https://docs.unity3d.com/Manual/OculusControllers.html)和[OpenVR 输入](https://docs.unity3d.com/Manual/OpenVRControllers.html)。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-223">The general Input.GetButton/Input.GetAxis APIs are used by Unity VR apps today for [Oculus input](https://docs.unity3d.com/Manual/OculusControllers.html) and [OpenVR input](https://docs.unity3d.com/Manual/OpenVRControllers.html).</span></span> <span data-ttu-id="b7d9a-224">如果你的应用程序已使用这些用于运动控制器的 Api，这是最简单的路径，你只需在输入管理器中重新映射按钮和轴即可。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-224">If your apps are already using these APIs for motion controllers, this is the easiest path - you should just need to remap buttons and axes in the Input Manager.</span></span>
    * <span data-ttu-id="b7d9a-225">您可以使用一般的 GetButton/GetAxis Api 或 MR 专用 UnityEngine. XR Api 来访问 Unity 中的运动控制器数据。. Api。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-225">You can access motion controller data in Unity using either the general cross-VR-SDK Input.GetButton/Input.GetAxis APIs or the MR-specific UnityEngine.XR.WSA.Input APIs.</span></span> <span data-ttu-id="b7d9a-226">（以前在 Unity 5.6 的 UnityEngine 命名空间中）</span><span class="sxs-lookup"><span data-stu-id="b7d9a-226">(previously in the UnityEngine.XR.WSA.Input namespace in Unity 5.6)</span></span>
    * <span data-ttu-id="b7d9a-227">请参阅组合游戏板和运动控制器的[工具包中的示例](https://github.com/Microsoft/HoloToolkit-Unity/pull/572)。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-227">See the [example in Toolkit](https://github.com/Microsoft/HoloToolkit-Unity/pull/572) that combines gamepad and motion controllers.</span></span>

### <a name="unity-step-10-performance-testing-and-tuning"></a><span data-ttu-id="b7d9a-228">Unity 步骤10：性能测试和优化</span><span class="sxs-lookup"><span data-stu-id="b7d9a-228">Unity step 10: Performance testing and tuning</span></span>

<span data-ttu-id="b7d9a-229">Windows Mixed Reality 将在各种设备上可用，范围从高端游戏电脑到广泛市场主流 Pc。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-229">Windows Mixed Reality will be available on a broad class of devices, ranging from high end gaming PCs, down to broad market mainstream PCs.</span></span> <span data-ttu-id="b7d9a-230">根据你的目标市场，你的应用程序的可用计算和图形预算有很大的差异。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-230">Depending on what market you're targeting, there's a significant difference in the available compute and graphics budgets for your application.</span></span> <span data-ttu-id="b7d9a-231">在此迁移过程中，你可能会利用高级 PC，并为应用提供大量的计算和图形预算。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-231">During this porting exercise, you're likely leveraging a premium PC, and have had significant compute and graphics budgets available to your app.</span></span> <span data-ttu-id="b7d9a-232">如果你希望将应用程序提供给更广泛的受众，则应在[你想要面向的代表硬件](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/windows-mixed-reality-minimum-pc-hardware-compatibility-guidelines)上测试和分析你的应用程序。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-232">If you wish to make your app available to a broader audience, you should test and profile your app on [the representative hardware that you wish to target](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/windows-mixed-reality-minimum-pc-hardware-compatibility-guidelines).</span></span>

<span data-ttu-id="b7d9a-233">[Unity](https://docs.unity3d.com/Manual/Profiler.html)和[Visual Studio](https://docs.microsoft.com/visualstudio/profiling/index)都包含性能探查器， [Microsoft](understanding-performance-for-mixed-reality.md)和[Intel](https://software.intel.com/articles/vr-content-developer-guide)发布有关性能分析和优化的指导原则。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-233">Both [Unity](https://docs.unity3d.com/Manual/Profiler.html) and [Visual Studio](https://docs.microsoft.com/visualstudio/profiling/index) include performance profilers, and both [Microsoft](understanding-performance-for-mixed-reality.md) and [Intel](https://software.intel.com/articles/vr-content-developer-guide) publish guidelines on performance profiling and optimization.</span></span> <span data-ttu-id="b7d9a-234">在[了解混合现实的性能](understanding-performance-for-mixed-reality.md)方面，提供了有关性能的广泛讨论。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-234">There's an extensive discussion of performance available at [Understanding Performance for Mixed Reality](understanding-performance-for-mixed-reality.md).</span></span> <span data-ttu-id="b7d9a-235">此外，针对[unity 的性能建议](performance-recommendations-for-unity.md)下的 unity 有特定的详细信息。</span><span class="sxs-lookup"><span data-stu-id="b7d9a-235">Further, there are specific details for Unity under [Performance Recommendations for Unity](performance-recommendations-for-unity.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="b7d9a-236">另请参阅</span><span class="sxs-lookup"><span data-stu-id="b7d9a-236">See also</span></span>
* [<span data-ttu-id="b7d9a-237">Unity 的输入移植指南</span><span class="sxs-lookup"><span data-stu-id="b7d9a-237">Input porting guide for Unity</span></span>](input-porting-guide-for-unity.md)
* [<span data-ttu-id="b7d9a-238">Windows Mixed Reality 最小电脑硬件兼容性指南</span><span class="sxs-lookup"><span data-stu-id="b7d9a-238">Windows Mixed Reality minimum PC hardware compatibility guidelines</span></span>](https://docs.microsoft.com/windows/mixed-reality/enthusiast-guide/windows-mixed-reality-minimum-pc-hardware-compatibility-guidelines)
* [<span data-ttu-id="b7d9a-239">了解混合现实的性能</span><span class="sxs-lookup"><span data-stu-id="b7d9a-239">Understanding Performance for Mixed Reality</span></span>](understanding-performance-for-mixed-reality.md)
* [<span data-ttu-id="b7d9a-240">Unity 性能建议</span><span class="sxs-lookup"><span data-stu-id="b7d9a-240">Performance Recommendations for Unity</span></span>](performance-recommendations-for-unity.md)
* [<span data-ttu-id="b7d9a-241">向适用于 UWP 的 Unity 添加 Xbox Live 支持</span><span class="sxs-lookup"><span data-stu-id="b7d9a-241">Add Xbox Live support to Unity for UWP</span></span>](https://docs.microsoft.com/windows/uwp/xbox-live/get-started-with-partner/partner-add-xbox-live-to-unity-uwp)
